---
# Unified Secret Template for NervesHub Deployment
# This file contains ALL secrets for both NervesHub application and PostgreSQL
#
# INSTRUCTIONS:
# 1. Copy this file to secrets.yaml: cp secrets.yaml.example secrets.yaml
# 2. Fill in all the values below with your actual secrets
# 3. Run 'make seal-secrets' to create the sealed secret
# 4. The sealed secret will be created at: sealed-secrets/sealed-secret-unified.yaml
# 5. Apply it with: make apply-sealed-secret
#
# IMPORTANT: After sealing, you can delete secrets.yaml or store it securely
# The sealed secret can only be decrypted by your Kubernetes cluster
#
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  name: nerves-hub-unified
  namespace: nerves-hub
  labels:
    app.kubernetes.io/name: nerves-hub
    app.kubernetes.io/component: secrets
type: Opaque
stringData:
  # ============================================================================
  # NervesHub Application Secrets
  # ============================================================================

  # Database connection URL
  # Format: postgresql://username:password@host:port/database?ssl=false
  # Make sure the password matches the PostgreSQL password below
  DATABASE_URL: "postgresql://postgres:CHANGE_ME_POSTGRES_PASSWORD@nerves-hub-postgresql:5432/nerves_hub?ssl=false"

  # ClickHouse connection URL
  CLICKHOUSE_URL: "http://nerves-hub-clickhouse:8123/default"

  # Phoenix secret key base (generate with: mix phx.gen.secret OR openssl rand -base64 64)
  # Must be at least 64 characters
  SECRET_KEY_BASE: "CHANGE_ME_GENERATE_WITH_mix_phx_gen_secret_minimum_64_characters_required_here"

  # LiveView signing salt (generate with: mix phx.gen.secret OR openssl rand -base64 32)
  # Must be at least 8 characters
  LIVE_VIEW_SIGNING_SALT: "CHANGE_ME_GENERATE_WITH_mix_phx_gen_secret"

  # ============================================================================
  # PostgreSQL Secrets
  # ============================================================================

  # PostgreSQL user password (used by the 'postgres' user)
  # Generate with: openssl rand -base64 32
  password: "CHANGE_ME_POSTGRES_PASSWORD"

  # PostgreSQL superuser password (same as password for single-user setup)
  postgres-password: "CHANGE_ME_POSTGRES_PASSWORD"

# ============================================================================
# TLS Certificates
# ============================================================================
#
# NOTE: TLS certificates (DEVICE_SSL_KEY and DEVICE_SSL_CERT) are automatically
# read from certs/key.pem and certs/cert.pem by the Makefile during sealing.
#
# Generate certificates with:
#   cd certs
#   openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes \
#     -subj "/CN=nerves-hub.local"
#   cd ..
#
# Then run: make seal-secrets
